name: Verify Assignment Structure

on:
  # Trigger on push to this specific bonus branch
  push:
    branches: [ "action_verifier" ]
  # Also trigger when you eventually do a Pull Request to main
  pull_request:
    branches: [ "main" ]

jobs:
  check-structure:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Verify Repository Requirements
        run: |
          python -c "
          import os
          import sys
          import json

          # 1. Define the Expected Structure from the Assignment PDF
          required_dirs = ['models', 'notebooks', 'results', 'utils']
          required_files = ['README.md', 'report.md'] 

          missing_items = []

          # 2. Check Directories
          for directory in required_dirs:
              if not os.path.isdir(directory):
                  missing_items.append(f'Missing Folder: {directory}/')

          # 3. Check Files
          for file in required_files:
              if not os.path.isfile(file):
                  missing_items.append(f'Missing File: {file}')

          # 4. Verify JSON Metrics in 'results/'
          # The assignment requires files like metrics_v1.json to be valid
          if os.path.isdir('results'):
              json_files = [f for f in os.listdir('results') if f.endswith('.json')]
              if not json_files:
                  print('Warning: No JSON files found in results/ yet.')
              else:
                  for jf in json_files:
                      try:
                          with open(os.path.join('results', jf), 'r') as f:
                              json.load(f)
                      except json.JSONDecodeError:
                          missing_items.append(f'Invalid JSON syntax: results/{jf}')

          # 5. Report Results
          if missing_items:
              print('The following issues were found in your repository structure:')
              for issue in missing_items:
                  print(f' - {issue}')
              print('\nPlease fix these to match the assignment requirements.')
              sys.exit(1) # This causes the Action to fail (Red X)
          else:
              print('Success! Repository structure matches the assignment requirements.')
          "
